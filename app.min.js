/*!
 * Kartooner.com - Consolidated Scripts
 * Weather, Theme Toggle, Progressive Images, Shimmer Effect
 */
(function(){"use strict";async function e(){try{const e=await fetch("https://api.weather.gov/points/43.1566,-77.6088"),t=await e.json(),n=await fetch(t.properties.forecastHourly),a=await n.json(),i=Math.round(a.properties.periods[0].temperature),o=document.getElementById("weather");o?o.textContent=` (${i}°F)`:console.error("Weather span not found")}catch(e){console.error("Error fetching weather:",e)}}document.addEventListener("DOMContentLoaded",e);const t=document.getElementById("theme-toggle"),n=t.querySelector(".theme-toggle-icon"),a=t.querySelector(".theme-toggle-text"),i=document.documentElement,o=localStorage.getItem("theme")||"dark";function s(e){"light"===e?(n.textContent="☀️",a.textContent="Light mode",t.setAttribute("aria-pressed","true")):(n.textContent="🌙",a.textContent="Dark mode",t.setAttribute("aria-pressed","false"))}i.setAttribute("data-theme",o),s(o),t.addEventListener("click",(function(){const e=i.getAttribute("data-theme")||"dark",t="dark"===e?"light":"dark";i.setAttribute("data-theme",t),localStorage.setItem("theme",t),s(t)})),t.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())}));class r{constructor(){this.addSkeletonStyles(),this.init()}addSkeletonStyles(){if(document.querySelector("#progressive-image-styles"))return;const e=document.createElement("style");e.id="progressive-image-styles",e.textContent=".image-skeleton{position:relative;overflow:hidden;background:linear-gradient(90deg,var(--skeleton-bg,#f0f0f0) 25%,var(--skeleton-shimmer,#e0e0e0) 50%,var(--skeleton-bg,#f0f0f0) 75%);background-size:200% 100%;animation:skeleton-shimmer 1.5s infinite;border-radius:4px}[data-theme=dark] .image-skeleton{--skeleton-bg:rgba(255,255,255,.1);--skeleton-shimmer:rgba(255,255,255,.15)}@keyframes skeleton-shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}.progressive-img{transition:opacity .3s ease;opacity:0}.progressive-img.loaded{opacity:1}.progressive-img.error{opacity:1;filter:grayscale(1) brightness(.8)}",document.head.appendChild(e)}enhanceImage(e){if(!e.src)return;const t=document.createElement("div");t.style.position="relative",t.style.display="inline-block",t.style.width=e.style.width||"100%",t.style.height="auto";const n=document.createElement("div");n.className="image-skeleton",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="1",n.style.pointerEvents="none",e.parentNode.insertBefore(t,e),t.appendChild(e),t.appendChild(n),e.classList.add("progressive-img");const a=e.src,i=new Image;i.onload=()=>{e.classList.add("loaded"),setTimeout(()=>{n.parentNode&&n.remove()},300)},i.onerror=()=>{e.classList.add("error"),n.style.background="repeating-linear-gradient(45deg, rgba(255,0,0,0.1), rgba(255,0,0,0.1) 10px, transparent 10px, transparent 20px)",n.style.animation="none",setTimeout(()=>{n.parentNode&&n.remove()},1e3)},setTimeout(()=>{i.src=a},100)}enhanceExistingImages(){const e=document.querySelectorAll("img[data-progressive]");e.forEach(e=>{e.removeAttribute("data-progressive"),e.hasAttribute("loading")||(e.loading="lazy"),this.enhanceImage(e)})}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.enhanceExistingImages()}):this.enhanceExistingImages(),window.MutationObserver&&new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(1===e.nodeType){const t=e.querySelectorAll?e.querySelectorAll("img[data-progressive]"):[];t.forEach(e=>{e.removeAttribute("data-progressive"),this.enhanceImage(e)})}})})}).observe(document.body,{childList:!0,subtree:!0})}static enhanceImage(e){new r().enhanceImage(e)}}new r,window.ProgressiveImageLoader=r;function c(){return window.innerWidth>=769&&!("ontouchstart"in window)}function l(){if(!c())return;const e=document.querySelector(".top-skills-box");if(!e)return;let t=!1;function n(n){if(!t)return;const a=e.getBoundingClientRect(),i=100*((n.clientX-a.left)/a.width),o=100*((n.clientY-a.top)/a.height);e.style.background="light"===document.documentElement.getAttribute("data-theme")?`\n                    radial-gradient(circle, rgba(0, 102, 204, 0.03), rgba(0, 102, 204, 0.01)),\n                    radial-gradient(circle at ${i}% ${o}%, \n                        rgba(0, 102, 204, 0.2) 0%, \n                        rgba(0, 102, 204, 0.1) 30%, \n                        rgba(0, 102, 204, 0) 70%\n                    )\n                `:`\n                radial-gradient(circle, #2c9ecb1a, #a1177708),\n                radial-gradient(circle at ${i}% ${o}%, \n                    rgba(255, 255, 255, 0.15) 0%, \n                    rgba(255, 255, 255, 0.05) 30%, \n                    rgba(255, 255, 255, 0) 70%\n                )\n            `}e.addEventListener("mouseenter",()=>{t=!0,e.classList.add("mouse-following")}),e.addEventListener("mouseleave",()=>{t=!1,e.classList.remove("mouse-following"),e.style.background=""}),e.addEventListener("mousemove",n);const a=document.getElementById("theme-toggle");a&&a.addEventListener("click",()=>{setTimeout(()=>{if(t){const t=e.getBoundingClientRect(),a=new MouseEvent("mousemove",{clientX:t.left+t.width/2,clientY:t.top+t.height/2});n(a)}},50)}),window.addEventListener("resize",()=>{!c()&&t&&(t=!1,e.classList.remove("mouse-following"),e.style.background="")})}if("loading"===document.readyState)document.addEventListener("DOMContentLoaded",l);else l();let d,u=[],m=!1;async function h(){if(m)return;m=!0;try{const e=await fetch("/feed.xml"),t=await e.text(),n=(new DOMParser).parseFromString(t,"text/xml"),a=Array.from(n.querySelectorAll("item")).slice(0,10).map(e=>({title:e.querySelector("title").textContent.trim(),link:e.querySelector("link").textContent.trim(),pubDate:new Date(e.querySelector("pubDate").textContent),description:e.querySelector("description").textContent.trim(),category:e.querySelector("category")?e.querySelector("category").textContent.trim():null}));u=a,g()}catch(e){console.error("Error loading RSS:",e)}}function g(){const e=document.querySelector("#recent-writing");if(!e||0===u.length)return;const t=u.slice(0,3).map(e=>{const t=e.pubDate.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return`<article class="writing-item"><h4><a href="${e.link}" target="_blank" rel="noopener noreferrer">${e.title}</a></h4><time datetime="${e.pubDate.toISOString()}">${t}</time><p>${e.description.substring(0,120)}...</p></article>`}).join("");e.innerHTML=t}document.addEventListener("DOMContentLoaded",()=>{h(),document.querySelector("#recent-writing")&&(clearInterval(d),d=setInterval(h,6e5))}),window.addEventListener("beforeunload",()=>{d&&clearInterval(d)})})();